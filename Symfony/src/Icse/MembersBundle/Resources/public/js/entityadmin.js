(function(){if(typeof initCreateForm!="function"){window.initCreateForm=function(){}}if(typeof initEditForm!="function"){window.initEditForm=function(){}}if(typeof postTableReload!="function"){window.postTableReload=function(){}}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};$("button").button();$("input.time").timepicker({timeFormat:"g:i a"});$("input.date").datepicker({dateFormat:"dd/mm/yy"});$("#edit_form input:submit, #import_csv_form input:submit").hide();$("form").each(function(){if($(this).find("input").first().is(".date, .time")){$(this).before('<input type="text" style="width: 0; height: 0; top: -100px; position: absolute;">')}});$("#edit_form input:submit").before('<input type=hidden name="_method" value="POST" >');var g=0;function a(){g+=1;$(".table_buttons .loading_spinner").show()}function d(){g-=1;if(g==0){$(".table_buttons .loading_spinner").hide()}}$.fn.isAnyTableRowSelected=function(){return $(this).hasClass("ui-selected")};$.fn.areAllTableRowsSelected=function(){return $(this).not("thead tr").not(".ui-selected").length==0};$.fn.isExactlyOneTableRowSelected=function(){return $(this).filter(".ui-selected").length==1};function e(i){if(typeof i==="undefined"){i=200}if(!$("tbody tr").isAnyTableRowSelected()){$(".show_if_none_selected").show(i);$(".show_if_one_selected, .show_if_any_selected").hide(i)}else{if($("tbody tr").isExactlyOneTableRowSelected()){$(".show_if_one_selected, .show_if_any_selected").show(i);$(".show_if_none_selected").hide(i)}else{$(".show_if_any_selected").show(i);$(".show_if_none_selected, .show_if_one_selected").hide(i)}}}e(0);function c(){var i=$("tbody").selectable({filter:"tr",stop:e});var j=i.data("uiSelectable")["_mouseStart"];i.data("uiSelectable")["_mouseStart"]=function(k){j.call(this,k);this.helper.css({top:-1,left:-1})};$("tbody tr").dblclick(b);$("abbr.timeago").timeago();$("tr.just_updated").removeClass("just_updated",1000)}c();function f(){$("#admin_table_container").load(currentPath+"/table",function(){c();postTableReload();d();e();$(".ui-widget-overlay").height($(document).height())});a()}$("#edit_dialog").dialog({autoOpen:false,modal:true,width:500,minWidth:500,height:500,dialogClass:"edit_dialog",buttons:[{text:"",click:function(){$("#edit_form input:submit").click()},"class":"submit_button"},{text:"Cancel",click:function(){$(this).dialog("close")},"class":"cancel_button"}]});$("#delete_dialog").dialog({autoOpen:false,resizable:false,modal:true,width:400,dialogClass:"delete_dialog",buttons:{Delete:function(){var i=$("tbody tr.ui-selected").length;var j=0;if(i>0){$(".delete_dialog .ui-dialog-buttonset .loading_spinner").show();$(".delete_dialog .ui-dialog-buttonset button").button("disable");$("tbody tr.ui-selected").each(function(){var k=$(this).data("entity").id;$.ajax({type:"POST",data:{_method:"DELETE"},url:currentPath+"/"+k,dataType:"json"}).fail(function(){j+=1}).always(function(l){i-=1;if(i===0){$(".delete_dialog .ui-dialog-buttonset .loading_spinner").hide();$(".delete_dialog .ui-dialog-buttonset button").button("enable");if(j===0){$("#delete_dialog").dialog("close");$("table tr.ui-selected").addClass("just_deleted");f()}}})})}else{$(this).dialog("close")}},Cancel:function(){$(this).dialog("close")}}});$(".table_buttons .loading_spinner").clone().prependTo(".ui-dialog-buttonset");function h(){$(".edit_dialog .ui-dialog-buttonset .submit_button .ui-button-text").html("Create");$("#edit_dialog").dialog("open").dialog({title:"Add "+entitySingular.capitalize()});$("#edit_form").attr("method","POST");$('#edit_form input[name="_method"]').val("POST");$("#edit_form").attr("action",currentPath);$("#edit_form").find("input, textarea").not(":button, :submit, :reset, :hidden, :radio, :checkbox").val("");$("#edit_form").find(".error").remove();initCreateForm()}$("button.create").click(h);function b(){var j=$("tbody tr.ui-selected");if(j.length!=1){return}var i=j.first().data("entity");$(".edit_dialog .ui-dialog-buttonset .submit_button .ui-button-text").html("Save Changes");$("#edit_dialog").dialog("open").dialog({title:"Edit "+entitySingular.capitalize()});$('#edit_form input[name="_method"]').val("PUT");$("#edit_form").attr("method","POST");$("#edit_form").find(".error").remove();$("#edit_form").attr("action",currentPath+"/"+i.id);$("#edit_form").find("input, select, textarea").not(":button, :submit, :reset, :hidden, :radio, :checkbox").each(function(){var m=$(this).attr("name").split("[");m.splice(0,1);m=$.map(m,function(o,n){return o.split("]")[0]});var k=m[0];if(i.hasOwnProperty(k)){var l=i[k];if(l===false){l=0}else{if(l===true){l=1}}if(m[1]=="date"){l=moment(parseInt(l)).format("DD/MM/YYYY")}if(m[1]=="time"){l=moment(parseInt(l)).format("h:mm a")}if(typeof l=="object"){if($(this).prop("tagName")=="SELECT"){l=l.id}else{l=l.name}}$(this).val(l)}else{$(this).val("")}});initEditForm()}$("button.edit").click(b);$("button.refresh").click(f);$("button.unselectall, #above_footer, #signupsfilter a").click(function(){$("tbody tr").removeClass("ui-selected");e()});$(".table_buttons button").click(function(i){i.stopPropagation()});$("button.delete").click(function(){$("#delete_dialog").dialog("open")});$(".ui-dialog form").submit(function(){var j=$(this);var i=j.closest(".ui-dialog-content");var l=i.nextAll(".ui-dialog-buttonpane");if(j.find("input:file").length!==0){var k=new FormData(j[0]);var n=false;var m=false}else{var k=j.serialize();var n="application/x-www-form-urlencoded; charset=UTF-8";var m=true}$.ajax({type:j.attr("method"),url:j.attr("action"),data:k,dataType:"json",cache:false,contentType:n,processData:m,complete:function(o){}}).always(function(){l.find(".loading_spinner").hide();l.find("button").button("enable")}).done(function(o){if(o.status=="success"){i.dialog("close");f()}else{if(o.status=="partial"){f()}for(var q in o.errors){var p=$("<div/>",{"class":"error",text:(function(){var s=o.errors[q];if(typeof s==="string"){return s}else{if(typeof s==="object"&&typeof s.first==="object"){return s.first[0]}else{return s[0]}}})()});var r=j.find('*[name*="['+q+']"]');if(isNaN(q)&&r.length!==0){r.before(p)}else{if(isNaN(q)){p.html(q+": "+p.html())}p.addClass("global_error").appendTo(j)}}}});l.find(".loading_spinner").show();l.find("button").button("disable");j.find(".error").remove();return false})})();