(function(e){e.fn.shuffleChildren=function(){this.each(function(){e(this).children().sort(function(){return Math.random()-.5}).detach().appendTo(this)});return this};e(document).ready(function(){var n;const r="icsedb";const i=1;var t=300;var a=e("form#join_us").hasClass("freshersfair");var o=e("section.main").clone();var l;var s;var u=e(["Aeronautics","Bioengineering","Chemical Engineering","Civil and Environmental Engineering","Computing","Dyson School of Design Engineering","Earth Science and Engineering","Electrical and Electronic Engineering","Materials","Mechanical Engineering","Institute of Clinical Sciences","Department of Medicine","National Heart and Lung Institute","School of Public Health","Department of Surgery and Cancer","Lee Kong Chian School of Medicine - London Office","Imperial College Academic Health Science Centre","Imperial College Healthcare NHS Trust","Chemistry","Mathematics","Physics","Life Sciences","Centre for Environmental Policy","Business School","Finance","Innovation and Entrepreneurship","Management","Data Science Institute","Energy Futures Lab","Institute of Global Health Innovation","Grantham Institute - Climate Change and the Environment","Institute for Security Science and Technology","Careers Service","Centre for Academic English","Centre for Languages, Culture and Communication","Educational Development Unit","Graduate School","Library","Post Doc Development Centre","School of Professional Development"]);const f=function(){var n=moment(e("#current_server_time").text());var r=moment();return n.diff(r)}();window.ON_CHANGE_OFFLINE_MODE=function(){var r=e("input#submit");if(IN_OFFLINE_MODE){r.prop("disabled",true);c().done(function(){r.prop("disabled",false)})}else{if("close"in n)n.close();r.prop("disabled",false)}};function c(){var t=e.Deferred();var a=indexedDB.open(r,i);a.onsuccess=function(e){n=e.target.result;n.onerror=function(e){alert("Database error: "+e.target.errorCode)};t.resolve()};a.onerror=function(e){console.error("open_db:",e.target.errorCode);t.reject()};a.onupgradeneeded=function(e){console.log("Upgrading DB");n=e.target.result;if(!n.objectStoreNames.contains("signup")){n.createObjectStore("signup",{keyPath:"id",autoIncrement:true})}};a.onblocked=function(e){alert("Please close all other tabs with this site open!")};return t.promise()}function m(n){if(s===null){e(".show_if_email, .show_if_username, .show_if_player, #username_or_email_error").slideUp(n)}else if(s==="email"){e(".show_if_email").slideDown(n)}else if(s==="username"){e(".show_if_username").slideDown(n)}else if(s==="error"){e("#username_or_email_error").slideDown()}if(l!==null){e("#username_or_email_lookup").slideDown(n)}if(s==="email"||s==="username"){if(l){e(".show_if_player").slideDown(n)}else{e(".show_if_player").slideUp(n)}}}function d(e){var n=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;return n.test(e)}function p(e){var n=/^[a-zA-Z0-9]+$/i;return n.test(e)}function _(n){if(s===null){var r=e("#username_or_email_lookup");var i=r.find("input");var t=r.find(".loading_spinner");i.prop("disabled",true);t.show();var a=e("#username_or_email_field").val();var o=function(r){if(r["type"]=="email"){s="email";e("#form_email").val(a);e("#form_login").val("");e("#form_department").val("")}else if(r["type"]=="username"){s="username";e("#form_login").val(a);if("first_name"in r){e("#form_first_name").val(r["first_name"]);e("#form_last_name").val(r["last_name"]);e("#form_email").val(r["email"]);e("#form_department").val(r["department"])}}else{s="error"}e(".error_list").remove();m(n);if(n){setTimeout(function(){e("input#form_first_name").focus()},300)}};var l=function(){i.prop("disabled",false);t.hide()};if(window.IN_OFFLINE_MODE){var u=d(a)?"email":p(a)?"username":"other";o({type:u});l()}else{e.ajax({dataType:"json",url:Routing.generate("IcsePublicBundle_query_username"),data:{input:a}}).done(o).always(l)}}}function h(){_(t)}function v(){var n=e('input[name="form[instrument][]"]');if(l){if(n.is(":checked")){n.prop("required",false)}else{n.prop("required",true)}}else{n.prop("required",false)}}function g(n){if(e('#form_player input[value="1"]').is(":checked")){l=true;e("#form_standard").prop("required",true);y()}else if(e('#form_player input[value="0"]').is(":checked")){l=false;e("#form_standard").prop("required",false);e("#form_other_instrument").prop("required",false)}else{l=null}v();m(n);if(n){setTimeout(function(){e("input#username_or_email_field").focus()},300)}}function y(){if(e('#form_instrument input[value="other"]').is(":checked")){e("#form_other_instrument").prop("disabled",false);e("#form_other_instrument").prop("required",true)}else{e("#form_other_instrument").prop("disabled",true);e("#form_other_instrument").prop("required",false)}}function b(r){r.preventDefault();var i=e("input#submit");var t=e(".loading_spinner.final_submit");i.prop("disabled",true);t.show();var l=e(this).serializeArray();var s=function(){i.prop("disabled",false);t.hide()};var u=function(n){e("section").replaceWith(e(n).find("section"));E();if(a&&e("form").length==0){setTimeout(function(){e("section").replaceWith(o.clone());E()},3e3)}};if(window.IN_OFFLINE_MODE){var c;var m={submitted_at:moment().add(f).toDate(),form_data:l};var d=/^form\[(\w+)\]/;var p=/^(.*)\[\]$/;l.forEach(function(e){var n=e.name.replace(d,"$1");var r=e.value;if(n=="first_name")c=r;var i=p.exec(n);if(i!==null){n=i[1];if(m.hasOwnProperty(n)){m[n].push(r)}else{m[n]=[r]}}else{m[n]=r}});var _=n.transaction("signup","readwrite");_.objectStore("signup").add(m);_.oncomplete=function(n){localStorage.setItem("icse_offline_signup_notify",moment().toISOString());var r=e("<body>",{html:e("<section>",{"class":"main",html:e("<p>",{text:"Thanks "+c+", we'll be in touch shortly."})})});s();u(r)}}else{e.ajax({type:e(this).attr("method"),url:e(this).attr("action"),data:l,dataType:"html",cache:false}).always(s).done(u)}return false}function w(e){if(e.keyCode<13||e.keyCode==32||e.keyCode>40){s=null;m(t)}else if(e.keyCode==13){e.preventDefault();h()}}function C(){s=null;m(t)}function E(){l=null;s=null;e(".never_show").hide();m(0);y();g(0);if(e("#username_or_email_field").val()!=""){s=e("#form_login").val()!=""?"username":"email";m(0)}e("#form_department").autocomplete({source:function(n,r){r(u.filter(function(r,i){return e.fuzzyMatch(i,n.term).score}).sort(function(r,i){var t=e.fuzzyMatch(r,n.term).score,a=e.fuzzyMatch(i,n.term).score;return t<a?1:t===a?0:-1}).slice(0,3))},delay:1});e("#username_or_email_lookup #lookup_button").click(h);e("#username_or_email_field").keydown(w);e("#username_or_email_field").bind("paste",C);e("#form_instrument").change(v);e("#form_instrument").change(y);e("#form_player").change(t,g);e("form").submit(b);D()}var D=function(){};if(a){(function(){var n=null;var r=e("html");var i=e("#slideshow.freshersfair");var t=i.find("#plugin_container");var a=t.find("#slides").detach();function o(){if(l===null){n=null;r.addClass("no-yscrollbar");i.show();var e=a.clone();e.find(".slides-container").shuffleChildren();t.append(e);e.superslides({play:4e3,animation:"fade",pagination:false})}}D=function(){t.empty();i.hide();r.removeClass("no-yscrollbar");if(n!==null)clearTimeout(n);n=setTimeout(o,5e3)};e(document).on("mousemove click touchstart",D)})()}E()})})(jQuery);